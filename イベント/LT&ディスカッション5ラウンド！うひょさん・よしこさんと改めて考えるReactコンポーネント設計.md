## 分割粒度

- よしこさん
  - https://zenn.dev/knowledgework/articles/99f8047555f700
- Uhyo
  - 1 ロジック 1 コンポーネント

## 構造

- Uhyo
  - 1 コンポーネント 1 フック
  - 中間状態の変数を JSX から勝手に触られるのを防ぐ
  - 特にロジックが複雑だと切り出すことが多い
  - render hooks パターン
    - https://engineering.linecorp.com/ja/blog/line-securities-frontend-3
  - 一目でどんなコンポーネントか把握したい
- ディスカッション
  - コロケーションを意識することは多い
  - コロケーション
    - https://www.mizdra.net/entry/2022/12/11/203940
  - 両者ともコロケーションはとても大事にしている
- 質問
  - ロジックをカスタムフックに切り出すとフックが肥大化しない？
    - 仕方ない
    - 地道に対処するしかない
    - 複数の hook に関数分割する

## スタイリング

- よしこさん
  - CSS Modules 使っている
  - stylelint でプロパティの並び順やコーディングルールを autofix
  - typed-css-modules を CI 上でだけ回してセレクタ参照チェック
- Uhyo
  - CSS Modules が好き
  - CSS の構文が直接書けるのはやっぱり偉い
  - margin を持ったコンポーネントは ×
    - 親コンポーネントのための実装が子コンポーネントに存在している状態なのでだめ
  - 暗黙の依存関係は避けたい
    - セットで書かれるスタイルはなるべく同じコンポーネントに詰め込む

## テスト

- よしこさん
  - Testing Trophy
  - コンポーネントのテストはどこをどうテストする？
- Uhyo
  - 基本は Hook に対するユニットテスト
    - ロジックに関するテストの需要が大きいため
- ディスカッション
  - RSC にしたらただの関数になるので、そもそも Hook とか関係ない
  - DOM のスナップショットテストって書く？
    - よしこさん: 今はやっていない
    - Uhyo さん: 今はやっていない。優先度が高いわけではない

## パフォーマンス

- よしこさん
  - バンドルサイズを細かく調整はしていない
    - メディアではないので
  - component 内での useMemo/useCallback の徹底もしていない
    - 早めに慣れて最初からやっておけば良かった
- Uhyo
  - コンポーネント分割と Suspense
  - useMemo はちゃんと使う
    - 重い計算を避けるというより、同じオブジェクトを同じままにする最適化・設計意図の明示という意味が大きい
    - React Forget 的なものが導入されたら変わるかも

## 質疑応答

- Q. CSS Modules が非推奨に？
- A. 結局サポートされている感じはあるから大丈夫では？多分大丈夫

- Q. 新規で作るときに App Router を使う？
- A. 新規で作るとしたら Next.js の App Router を使うと思う。メリットの方が大きい（Uhyo さん）。layout を使いたい（よしこさん）

- Q. RSC によって設計を変えたことある？
- A. Suspense をなるべく使うようにして備えている

- Q. Vercel にデプロイしないと App Router の機能がフルで使えないけどどうする？
- A. デプロイ先によって技術を変えることはない
