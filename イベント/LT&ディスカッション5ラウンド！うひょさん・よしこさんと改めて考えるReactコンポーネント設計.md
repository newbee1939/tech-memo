## 分割粒度

- よしこさん
  - https://zenn.dev/knowledgework/articles/99f8047555f700
- Uhyo さん
  - 1 ロジック 1 コンポーネント

## 構造

- Uhyo さん
  - 1 コンポーネント 1 フック
  - 中間状態の変数を JSX から勝手に触られるのを防ぐ
  - 特にロジックが複雑だと切り出すことが多い
  - render hooks パターン
    - https://engineering.linecorp.com/ja/blog/line-securities-frontend-3
  - 一目でどんなコンポーネントか把握したい
- ディスカッション
  - コロケーションを意識することは多い
  - コロケーション
    - https://www.mizdra.net/entry/2022/12/11/203940
  - 両者ともコロケーションはとても大事にしている
- 質問
  - ロジックをカスタムフックに切り出すとフックが肥大化しない？
    - 仕方ない
    - 地道に対処するしかない
    - 複数の hook に関数分割する

## スタイリング

- よしこさん
  - CSS Modules 使っている
  - stylelint でプロパティの並び順やコーディングルールを autofix
  - typed-css-modules を CI 上でだけ回してセレクタ参照チェック
- Uhyo さん
  - CSS Modules が好き
  - CSS の構文が直接書けるのはやっぱり偉い
  - margin を持ったコンポーネントは ×
    - 親コンポーネントのための実装が子コンポーネントに存在している状態なのでだめ
  - 暗黙の依存関係は避けたい
    - セットで書かれるスタイルはなるべく同じコンポーネントに詰め込む

## テスト

- よしこさん
  - Testing Trophy
  - コンポーネントのテストはどこをどうテストする？
- Uhyo さん
  - 基本は Hook に対するユニットテスト
    - ロジックに関するテストの需要が大きいため
- ディスカッション
  - RSC にしたらただの関数になるので、そもそも Hook とか関係ない
  - DOM のスナップショットテストって書く？
    - よしこさん: 今はやっていない
    - Uhyo さん: 今はやっていない。優先度が高いわけではない

## パフォーマンス

- よしこさん
  - バンドルサイズを細かく調整はしていない
    - メディアではないので
  - component 内での useMemo/useCallback の徹底もしていない
    - 早めに慣れて最初からやっておけば良かった
- Uhyo さん
  - コンポーネント分割と Suspense
  - useMemo はちゃんと使う
    - 重い計算を避けるというより、同じオブジェクトを同じままにする最適化・設計意図の明示という意味が大きい
    - React Forget 的なものが導入されたら変わるかも

## 質疑応答

- Q. CSS Modules が非推奨に？
- A. 結局サポートされている感じはあるから大丈夫では？多分大丈夫

- Q. 新規で作るときに App Router を使う？
- A. 新規で作るとしたら Next.js の App Router を使うと思う。メリットの方が大きい（Uhyo さん）。layout を使いたい（よしこさん）

- Q. RSC によって設計を変えたことある？
- A. Suspense をなるべく使うようにして備えている

- Q. Vercel にデプロイしないと App Router の機能がフルで使えないけどどうする？
- A. デプロイ先によって技術を変えることはない

## 感想

- 分割粒度
  - 自分のところでは template > modules > parts みたいな形で切ることが多いかも
  - 表示ロジックを持たないコンポーネントは parts に置くみたいな
  - 「1 ロジック 1 コンポーネント」の考え方はシンプルで分かりやすいし、指針としては良さそう
  - これに関しては答えがあるわけではないので、色々な例を参考にしつつ、試行錯誤するしかないかな
- 構造
  - コロケーションは大事
  - これは NestJS とかバックエンドでもそうだけど、必要なものが必要な場所に適切にまとまっているだけで、影響範囲の切り分けがとてもしやすくなるし、改修のスピードも上がる
  - 1 コンポーネント 1 フックの発想はなかった
  - 自分だと、何でもかんでも Hook に切り出すのではなく、複数コンポーネントから再利用する処理を切り出すことが多いかな
- スタイリング
  - 逆に CSS in JS しか触ったことがないから、CSS Modules も触ってみたい
  - CSS in JS はその名の通りコンポーネントの中に直接 style を書けるから、コンポーネントと CSS の凝集度が高くて改修しやすいのがメリットだけど
  - やはり bundle サイズを圧迫してしまうのはデメリットなのかなと
  - スタイリングも明確な答えはなさそうなので、色々触ってみてからの判断かな
  - margin を持ったコンポーネントはより意識したい
  - stylelint は使ってみたい！
- テスト
  - コンポーネントのテストが無駄に複雑になるのは分かる
  - 自分も hook とか helper とか別のロジック関数に切り出して、そこをテストすることが多いかも
  - RSC が全てを解決するか？
- パフォーマンス
  - 自分は逆にメディアだから、bundle サイズはかなり気にする
  - PR ごとに bundle analysis も回してチェックしているし
  - この辺りはツールかメディアかで大きく考え方は変わりそう
