# 参考資料

- [x] 開発効率向上も、フレキシブルな働き方も、セキュリティの確保も、GitHub Codespaces で実現！-ストレスフリーな開発体験のカギ-
  - https://techplay.jp/video/273
- [x] Dev Container Template で開発環境をサクッと構築する
  - https://zenn.dev/takeyuwebinc/articles/fb18d3fb54d369
- [x] VSCode Dev Container を使った開発環境構築
  - https://blog.kinto-technologies.com/posts/2022-12-10-VSCodeDevContainer/
- [x] Dev Container 設定ファイルのサンプル
  - https://blog.kinto-technologies.com/posts/devcontainer_codespaces/#5.-%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB
- [x] 既存の Dev Container 設定。devcontainer.json を GitHub Codespaces に組み込む
- [x] GitHub の Codespaces を開発環境として導入する
  - https://info.drobe.co.jp/blog/engineering/github-codespaces
- [] GitHub Codespace を使った開発環境のメリットをまとめてみた
  - https://tech.isid.co.jp/entry/2023/07/10/GitHub_Codespace%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%81%AE%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%A6%E3%81%BF%E3%81%9F
- [x] GitHub 開発チームでの Codespaces の利用
  - https://github.blog/jp/2021-08-30-githubs-engineering-team-moved-codespaces/
  - この 14 年の間に、GitHub.com のコアリポジトリ（github/github）では 100 万回以上のコミットが行われました
  - これらのコミットの大部分は、macOS 上で開発やテストされたものです
  - 私たちの開発プラットフォームは進化しています。この数ヵ月の間に、私たちは macOS モデルを捨てて、GitHub.com の開発の大部分を Codespaces に移行しました
  - 私たちの日々の開発フローにとって根本的な変化でし
  - その結果、Codespaces はより強固なものとなり、GitHub.com 開発の将来に向けて万全の態勢を整えることができました
- [] [続！Dev Container] GitHub Codespaces でクラウド開発環境を構築
  - https://blog.kinto-technologies.com/posts/devcontainer_codespaces/
- [] GitHub Codespaces の公式資料
  - https://docs.github.com/ja/codespaces
- [] Devcontainer(Remote Container) いいぞという話 ~開発環境を整える~
  - https://qiita.com/yoshii0110/items/c480e98cfe981e36dd56
- [] Dev Container
  - https://code.visualstudio.com/docs/devcontainers/containers
- [] Dev Container を使ってステップバイステップで作る Python アプリケーション開発環境
  - https://tech.isid.co.jp/entry/2023/05/02/Dev_Container%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%B9%E3%83%86%E3%83%83%E3%83%97%E3%83%90%E3%82%A4%E3%82%B9%E3%83%86%E3%83%83%E3%83%97%E3%81%A7%E4%BD%9C%E3%82%8BPython%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1
- [] Dev Container Template
  - https://containers.dev/templates:w
- [] コンテナレジストリの利用
  - https://docs.github.com/ja/packages/working-with-a-github-packages-registry/working-with-the-container-registry
- [] Dev Container が VSCode から CLI にもやって来た
  - https://zenn.dev/hankei6km/articles/devcontainers-in-cli-ci
- [] 【VSCode】Remote Development について
  - https://makky12.hatenablog.com/entry/2022/12/05/120500
- [] VSCode Devcontainer 放浪記
  - https://zenn.dev/streamwest1629/articles/vscode_wanderer-in-devcontainer
- [] Visual Studio Code の Dev containers を使い始めて 2 ヶ月経ったので使い勝手をまとめてみた
  - https://devops-blog.virtualtech.jp/entry/20230728/1690512563

# メモ

- Dev Container, Codespaces, VSCode の Dev Container について
  - GitHub Codespaces とは
    - クラウドでホストされている開発環境
    - GitHub で利用できる統合開発環境(IDE)
    - GitHub Codespaces は、ブラウザ上で動作する開発環境となります。GitHub から起動することができて、ブラウザが動く環境であれば、追加でソフトウェアのインストールを必要とせず、いつでもどこでも開発作業が可能
    - GitHub Codespaces は、クラウド上に開発環境を構築し、クラウド上で完結する開発環境です。開発者はデバイスや場所に依存せず、どこからでもコードの編集や実行が可能になります
    - 従来の開発環境では、各個人の PC に環境を構築する必要がありましたが、Codespaces を使用するとその必要がありません
    - GitHub Codespaces は、クラウド上で完全な開発環境を提供するサービス
    - 構成ファイルをリポジトリにコミットすることで、GitHub Codespaces のプロジェクトをカスタマイズできます
    - GitHub Codespaces のカスタマイズ
      - codespace のランタイムとツールをカスタマイズするには、リポジトリ用に 1 つ以上の dev container 構成を作成できます
      - dev container 構成をリポジトリに追加すると、ユーザーがリポジトリで実行する作業に適したさまざまな開発環境の選択肢を定義できます
      - 開発コンテナーを構成せずに、リポジトリから codespace を作成する場合、GitHub Codespaces によって、多くのツール、言語、ランタイム環境が含まれる既定の codespace イメージを含む環境に、リポジトリがクローンされます
      - テンプレートから codespace を作成する場合は、既定のイメージの上のいくつかの初期構成から開始できます
    - GitHub Codespaces はクラウドベースの開発環境であり、インターネット接続が必要です
    - codespace で作業しているときにインターネットへの接続が失われると、その codespace にアクセスできなくなります。 ただし、コミットされていない変更はすべて保存されます
    - インターネット接続に再度アクセスできるようになると、切断されたときとまったく同じ状態で codespace に接続できます
    - インターネット接続が不安定な場合は、頻繁に変更をコミットしてプッシュする必要があります
    - オフラインで作業することが多いことがわかっている場合は、VS Code の "Dev Containers" 拡張機能(https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers)で devcontainer.json ファイルを使用して、リポジトリのローカル開発コンテナーをビルドしてアタッチできます
    - 詳細については、Visual Studio Code ドキュメントの「コンテナー内で開発する」(https://code.visualstudio.com/docs/devcontainers/containers)を参照してください
    - GitHub で利用できる統合開発環境(IDE)
  - Dev Container とは
    - Visual Studio Code Dev Containers 拡張機能を使用すると、コンテナをフル機能の開発環境として使用できます
      - Dev Container 環境とは VS Code の拡張機能 Dev Containers を使って構築する開発環境
    - VSCode Remote Container は、VSCode の拡張機能の 1 つです。Docker のコンテナ内で VSCode を開き、開発することを可能にします
    - Dev Container を立ち上げると VS Code から Docker コンテナをフル機能の開発環境として使用できます
    - ホストマシンからソースコードをマウントし、VS Code の拡張機能は コンテナ内にインストールされます
    - Dev Container 環境の VS Code の設定や拡張機能、インストールするライブラリや起動するサービスなどは devcontainer.json、Dockerfile、docker-compose.yml に定義することが出来ます
    - Dev Container 環境をビルドする際はこれらの設定を利用して自動的に行わるので、別個にインストールするのに比べ大幅に手順が簡略化されます
    - 環境構築手順書も Dev Container のビルドまでの手順のみとなります。複数人で開発する際の OS の差異の考慮も不要
    - これにより、コンテナ内の（またはコンテナにマウントされた）任意のフォルダを開き、Visual Studio Code の全機能を利用できるようになります
    - プロジェクト内の devcontainer.json ファイルは、明確に定義されたツールとランタイムスタックを持つ開発コンテナへのアクセス（または作成）方法を VS Code に伝えます
    - このコンテナは、アプリケーションを実行したり、コードベースの作業に必要なツール、ライブラリ、ランタイムを分離したりするために使用できます
    - チュートリアル
      - https://code.visualstudio.com/docs/devcontainers/tutorial
    - Getting started
      - https://code.visualstudio.com/docs/devcontainers/containers#_getting-started
    - 今どういう環境で開発しているのかファイルで確認でき、バージョン管理も容易
    - PC に Ruby やら Rubocop やら各種 CLI やらをいれる必要がなくなる
    - プロジェクトごとに言語等のバージョンを切り替える必要がなくなる
    - 確かに TypeScript の開発とかをしているときに PHP の拡張とかって不要だもんね
    - あらかじめ開発環境を docker image 化しておき、それをそれぞれの開発 PC 上で起動する事ができれば、開発参画が簡単になるのでは？
    - 新規チーム加入後に、環境構築します。手順書はこれねはい。
    - 中を見てみると作業 PC に何やらいっぱいインストール、vscode の Extension はこれとこれとこれと。。。
    - 正直、こんな感じで開発する前に環境揃えるのが大変で投げ出したくなるでしょう。かつローカル環境が汚染されている感じが嫌ではないでしょうか。
    - Devcontainer とは、 Docker コンテナを開発環境とし作成することで、開発環境に必要なライブラリやランタイムのバージョン、Extension をコンテナ内に閉じ込めその中で完結させることができます。
    - ユーザは、あるプロジェクトを開いた時に、Devcontainer で起動をするだけで開発環境が準備されるのです
    - 開発環境を docker image 化しておき、それをそれぞれの開発 PC 上で起動する事ができれば、開発参画が簡単になるのでは
    - それなりの PC 性能が要求される事はお忘れなきよう
    - 開発環境が VSCode に限定されるのはデメリット
    - 通常のコンテナ以上にメモリを消費するよ
    - Dev Container とは、開発環境もコンテナで
    - Devcontainer を気持ちよく運用するにはコツがいるよ
      - 開発環境だとしても，ビルドやプルで時間がかかるのは論外だからね
      - 対してキャッシュは積極的に使えるよ
      - root で動かすなシバくぞ
    - 開発環境をコンテナイメージとして管理
      - コンテナとして管理するといいことが多い
    - コンテナ内に入って開発を行う
      - ソースコードをバインドマウントさせる
    - Visual Studio Code の拡張機能の 1 つ
      - Docker コンテナを使用して Visual Studio Code のフル機能を使用できる開発環境を構築できる仕組み
    - メリット
      - コンテナ技術どうようにデプロイ先の OS 上で一貫性があり、再現性の高いツールとして開発できる
      - ローカルマシンへの影響を心配することなく、異なる開発環境間で素早く切り替えができる
      - 新しいメンバーと一貫した開発環境を構築できて配布が容易になるため、初期構築の手間を減らせる
      - ローカルマシンや他の環境に影響を与えないため、新しいバージョンやパッケージなどを試しやすい
    - Dev コンテナとは
      - Docker コンテナ自体を開発環境として作成する
      - メリット
        - 開発環境をコンテナ化するので、簡単に同一の開発環境が用意できる
        - VsCode の拡張機能もコンテナ内に入れられるので、自分のローカル環境を汚さず、開発環境に合わせた拡張機能だけを入れることができる
        - DevContainer を起動するだけで、コンテナ内に入った状態になるので、コンテナ内のコマンドがそのまま実行できる
      - DevContainer を使用しない場合、必要な拡張機能を個々人がインストールする必要があるので、簡単に同一環境を作成できるのは複数人環境で開発行う時には便利になるので、可能であれば DevContainer を導入する方が良いと言えます
    - 開発者全員の VSCode 環境を統一できるのが大きなメリット
      - VSCode の設定や拡張機能を揃えておくことで、開発者は実装に専念することができます
      - 必要な拡張とかをそれぞれが入れる必要ないし、プロジェクト間で不要な拡張を使うこともない
    - 開発環境をコンテナ化するので、簡単に同一の開発環境が用意できる
    - VsCode の拡張機能もコンテナ内に入れられるので、自分のローカル環境を汚さず、開発環境に合わせた拡張機能だけを入れることができる
    - DevContainer を起動するだけで、コンテナ内に入った状態になるので、コンテナ内のコマンドがそのまま実行できる
  - VSCode の Dev Container とは
    - 開発者のマシンで開発環境を構築する際に Docker 及び Docker compose を使って開発することが一般的になりました
    - ターミナルから docker compose コマンドを実行してテストや動作確認するのがセオリーですが、VS Code の Dev Containers 拡張を使うことにより VS Code で便利に開発する方法を提案します
      - SSH でリモートサーバにアクセスするように、コンテナに入った状態のターミナルを動かせるので、 docker compose exec ~~ と Docker のコマンドを打つ必要がなくなり、開発作業を楽にします
      - コンテナで起動する VS Code 拡張を指定できるので、Rubcop や Solargraph などの拡張機能をインストール・設定を開発者が個別にする必要がなくなり開発環境を標準化できます
  - GitHub Codespaces 上に構築する Dev Container と VSCode の Dev Container の違いは？どういう関係性？
    - 前回の記事では、Visual Studio Code（以下 VS Code）の Dev Container を活用し、快適な開発環境を構築する方法を紹介しました
    - Dev Container は非常に便利である一方、ローカルマシンのリソースを利用するため、パフォーマンスがマシンスペックに依存するという課題がありました
    - 特に Mac での使用では、ファイルシステム間の相互作用が原因で遅延が生じる場合がありました
    - Dev Container による開発環境構築をさらに進化させた GitHub Codespaces について解説します
    - GitHub Codespaces を利用することで、クラウドベースの開発環境を手軽かつ効率的に構築する方法をご紹介します
    - VSCode Dev Container だと、結局自分の PC 上での開発になる
    - GitHub Codespaces に Dev Container を構築する形だと、GitHub が用意したサーバー上で構築できる
  - 最新の開発環境事情について調べる
  - 現在の開発環境のデメリットについて
  - Codespaces とか Dev Container を入れるメリットについて
  - Codespaces とか Dev Container を入れるデメリットについて
    - 料金とかは？
  - まず「Remote Development」ですが、これは下記 3 つの拡張機能がセットになった拡張機能パッケージのことです。
    - 下記 3 つの拡張機能のインストールをまとめて Remote Development1 回のインストールで済ますことができます。(もちろん、機能なども単体で入れた場合と全く同じです)
      - Dev Containers(旧 Remote Containers。コンテナ環境での開発に便利)
      - Remote SSH(SSH を利用したリモートホストでの開発に便利)
      - WSL(ローカルフォルダを WSL 環境で開く(=Linux のように扱える))
  - Dev Container を使う前に何があったのか？
    - マシンを新調・初期化する際に同一の環境構築ができなかった
      - そもそも何を入れたのか覚えていない
      - どうやってインストールしたのか覚えていない
    - プロジェクトごとに期待している環境が違う
      - プロジェクトごとに使用しているバージョンやライブラリが違う
      - VSCode の拡張機能が衝突して予想外の動きをする

# 発表メモ

- GitHub Codespaces を使った開発環境のメリット
- Dev Container を使った環境統一
- この開発環境は十分に快適ですか？
  - 環境の多様化。うまくいく人といかない人がいる
  - 開発環境構築のコスト増加
    - オンボーディングのために時間などを合わせて出社
    - 設定完了後のトラブル
      - 手順書があってもうまく実施できない
- こういう開発環境が欲しい
  - 誰が起動しても同じ環境が保証されている
  - 故障が発生しない。しても新しい環境がすぐに手に入る
- そこで、GitHub Codespaces
  - クラウド上の仮想マシンに開発環境を構築してブラウザなどからアクセスして開発を行うことを可能にする GitHub のサービス
  - 開発用の計算機を用意することなく開発を行うことを可能にする
  - VSCode がブラウザで起動するようなもの
- GitHub Codespaces はクラウド上に環境が構築される
  - 故障時も新しい環境構築は簡単
  - そもそも壊れる可能性は低い（GitHub がダウンしたら使えなくなる）
- Dev Container を導入すると開発環境がコンテナで統一される
  - 誰が起動しても同一の環境になる
  - PC -> https -> GitHub Codespaces(dev container 環境)
- GitHub Codespaces の仕組み
  - GitHub のインフラ（Azure）上の仮想マシンで動作しているコンテナにアクセスする形になっている
    - コンテナ内部では vscode-server などが起動
    - 起動するコンテナのカスタマイズも可能
    - 開発に利用するミドルウェア(postgresql など)もコンテナとして起動することが可能
- VSCode からも利用することができる
  - GitHub Codespaces 拡張機能(GitHub Codespaces)のインストールが必要
  - リモートエクスプローラに GitHub Codespaces 用のメニューが追加される
    - connect できる。GitHub の Codespaces に接続可能
  - GitHub Codespaces の作成、削除、接続がここから実施できる
- GitHub Codespaces の便利なところ
  - GitHub にアクセス可能な環境であれば開発環境を利用できる
  - GitHub との親和性が高い
    - 起動した時点で開発向けの設定が行われている
      - ソースコードの clone が実施されている
      - GitHub へのアクセス設定が行われている
    - ブランチなどを指定して環境を構築できる
      - 特定の Pull Request のデバッグなどをするときに都度環境を構築する必要がない
  - 同じ開発環境を全メンバーが確実に構築可能に
  - AWS などのアクセスに使う機密情報なども GitHub Codespaces で隠蔽することができた
  - VSCode の拡張とかもいい感じにメンバー間で共通化できる
- GitHub Codespaces の課金形態
  - コンピューティング時間、ストレージ容量の課金の 2 種類がある
    - コンピューティング時間は GitHub Codespaces を起動している間発生
    - ストレージは GitHub Codespaces の VM が使用するストレージの容量に応じて発生
  - 注意
    - ストレージ利用料は起動していない間も料金が発生する
- Codespaces にはテンプレートもある
  - https://github.com/codespaces
  - Blank という Codespaces のテンプレートがある
    - ブランクと言いつつ、いろいろなツールがすでに入っている
      - python --version
- Dev Container による開発環境の統一
  - Dev Container
    - 開発環境統一のキモとなる機能
      - VSCode に搭載されているコンテナを開発環境として利用するための機能
        - 公式ドキュメント
          - https://code.visualstudio.com/docs/devcontainers/containers
- Dev Container で何が嬉しい？
  - <<GitHub Codespaces の導入で自宅などのアクセス環境に依存しない開発環境が手に入った>>
  - <<GitHub Codespaces 上に構築する開発環境も Dev Container を使って全員が統一された環境にできる>>
    - 構築に手間がかかる環境だとしても Dockerfile に閉じ込めてしまえる
- Dev Container の始め方
  - プロジェクトに設定ファイルを作成する
    - devcontainer/devcontainer.json というファイルを作成
    - GUI も可能
      - VSCode の右下
      - add devcontainer configuration file
    - GitHub の画面から設定することも可能
      - 「Configure dev container」
        - 最近追加された？
- feature 機能について
  - feature と呼ばれるコンテナに機能を追加する機能がある
    - dev container 導入時の GUI で追加
    - devcontainer.json に直接記述して追加
- template 機能
  - よくある構成の Dev Container 環境を構成する機能
    - GUI のメニューで template を選択して利用する
    - 例えば、postgres と特定のフレームワークや言語といった組み合わせの template がある
- 開発するときに毎回 build が走るのはしんどい
  - codespaces にはこれを解消する機能がある
  - プレビルド機能
  - プレビルドは、GitHub Actions に事前に build させることもできる
    - 初回の待ちも無くせる
- 感想
  - Codespaces や Dev Container は確かに便利だし、「環境構築自体が不要」なのは確かに革命なんだけど、GitHub に障害が起きた場合に開発できなくなるのは結構辛い気がする
  - 基本は Codespaces に統一しておいて、一応ローカル PC でも開発できるようにしておくのが良いのかも。
  - 後は料金だな
  - 後は、MacOS の種類によって動く動かないもなくなる
    - docker-compose に platform みたいなやつを指定する必要もない
    - 複数人で開発する際にホストマシンの OS を気にしなくて良い
  - 各種ライブラリ、パッケージの手順が不要
    - バックエンドの場合 mysql や redis を利用することが多いのでより強力
  - 環境構築を宣言的に定義して、共通化出来るので個人によるばらつきが出ない
    - VS Code の設定や拡張機能も定義できる
    - バージョン違いによる思わぬバグの遭遇が起きない
    - ローカル環境を汚さない、別 Workspace との競合が発生しない
  - デメリット
    - VS Code 以外の IDE を使いたい人の要望に応えられない
    - 普通の環境も作っておく必要はある
    - Pros/Cons を洗い出す
  - 言葉の定義も明確に
    - Remote Development
      - 3 つのツールを含んだ拡張
    - Dev Container
      - VSCode と GitHub Codespaces 上で動作可能
    - Remote Container
      - Dev Container の古い名前
    - GitHub Codespaces
      - クラウド上の IDE
    - GitHub Codespaces 上の Dev Container
    - VSCode 上の Dev Container
      - どこで動作してる？
  - Dev Container はブラウザ上でもクラウド上でも作れる？
  - ブラウザから Dev Container にアクセスする方法
  - 実行環境だけでなく、開発環境をまるっと Docker コンテナにする
  - 拡張は拡張のタブから devcontainer.json に追加できる
  - それぞれのやり方をわかりやすく解説する
  - ChatGPT でいい感じにまとめたい
  - 活用する
  - プロジェクト毎に開発環境を構築・共有できる
  - Dev Container は非常に便利である一方、ローカルマシンのリソースを利用するため、パフォーマンスがマシンスペックに依存するという課題がありました
  - 特に Mac での使用では、ファイルシステム間の相互作用が原因で遅延が生じる場合がありました
  - 私たちのチームでも実際に活用している Dev Container による開発環境構築をさらに進化させた GitHub Codespaces について解説します。GitHub Codespaces を利用することで、クラウドベースの開発環境を手軽かつ効率的に構築する方法をご紹介します
  - プレビルドしておきたい
  - 事前に composer install とか.env の作成とか、環境構築が終わった状態にしておきたい
    - アクセスしたらもうすぐに URL にアクセスしてすぐに Laravel の画面が出るようにしたい
  - Git とかどうするん？
    - Dev Container の中でコミットとかできるん？
  - 全てをまとめる
- TODO
  - dev container, codespaces, vscode の dev container のそれぞれが何を表しているかを調べて理解する
  - 他の人のトレースではなく、私が考える最強の開発環境を提唱する。
  - VSCode Dev Container を用いた Laravel 環境構築
    - 参考: https://www.engilaboo.com/laravel-docker/
  - GitHub Codespaces の Dev Container を用いた Laravel 環境構築
    - 参考: https://www.engilaboo.com/laravel-docker/
  - VSCode Dev Container を用いた Next.js 環境構築
    - 参考: https://www.engilaboo.com/laravel-docker/
  - GitHub Codespaces の Dev Container を用いた Next.js 環境構築
    - 参考: https://www.engilaboo.com/laravel-docker/
