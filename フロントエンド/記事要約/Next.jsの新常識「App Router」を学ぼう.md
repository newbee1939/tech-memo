# より直感的なルーティング、よりサーバーを活用したレンダリング

- Next.js は 2016 年に登場し、ブラウザで動くだけなのが当たり前だった React をサーバー側でレンダリングする（サーバーサイドレンダリング）というアプローチの先駆者として、この分野を牽引しています
- ただ、時代の要請に応えたり、後発のフレームワークにインスパイアされた新機能を取り込んでいくうちに、ルーティング機構が複雑になるのが近年の課題になっていました
- そこで、Next.js チームは、React の次の時代を牽引すべく、フレームワークの根幹ともいえるルーティング機構を再設計しました。それが Next.js 13.4 で安定版がリリースされた App Router（アップルーター） です
- App Router には大きな特徴が 2 つあります。ファイルパスの使い方の刷新と、レンダリングにおけるサーバーの活用です。

## ファイルパスの使い方を刷新

- まず一つ目として、ファイルパスの使い方の刷新です。フォルダ内のファイルパスでルーティングを決定する方式（file-system based router）であることは従来と変わりませんが、フォルダ名やファイル名の命名規則が大きく変わりました
- その一環として、App Router ではトップレベルのフォルダとして pages/ ではなく app/ を利用します。App Router という名前は、このフォルダ名に由来しており、従来のルーティング機構は Pages Router と呼ばれることになりました
- Pages Router では、レイアウトと呼ばれる機構を後付けした際に API が複雑になってしまいましたが、App Router ではレイアウトを初めから設計に組み込んでいるため、直感的に扱えるようになっています。

## サーバーをより活用したレンダリング

- 二つ目としては、レンダリングにおけるサーバーの活用が挙げられます。ここでいうレンダリングとは、あるデータに基づいて、条件分岐や反復処理を行い、コンポーネントの構造を決定する処理を指します（必ずしも HTML の生成は伴いません）。
- Pages Router にも、画面遷移時にサーバー側でデータ取得を行う機能はありました
- しかし、レンダリングまでサーバー側で請け負うのは、ページを直接リクエストする初期表示のときのみで、画面遷移後の（複雑な条件分岐や反復処理を含む）レンダリングや、ページ内の個別のコンポーネントによる非同期通信は、ブラウザ側に任されていました
- 一般論として、ブラウザの処理性能や通信の速度は、ユーザーの使っているネットワークやデバイスの性能に強く依存します。サーバーの性能はサービス提供者（この記事を読んでいるあなたも、おそらくそうでしょう）がチューニングしたりお金を払うことで向上させることができますが、ユーザーが個別の事情で型落ちのスマホや格安通信事業者を利用することに対しては、何の対処もできません。Pages Router のアプローチでは、サーバー側で処理できる比率が頭打ちしやすかったのです。
- そういった課題もあってか、App Router では思い切った戦略が取られました。原則として、 全ての React コンポーネントをサーバー側でレンダリングすることにした のです。通信も、条件分岐も、反復処理も、全てサーバーで行えば、ユーザーの環境によってパフォーマンスが落ちる要因を最低限にできます

## App Router を支える技術「React Server Components」

- App Router のレンダリング戦略を後押しするように、React というライブラリそのものにも、サーバーでレンダリングすることに特化した記法が追加されました。それが React Server Components（RSC）と呼ばれるコンポーネントです。厳密には Next.js ではなく React 側の新機能ですが、初めての活用事例が Next.js なので、Next.js のドキュメントで詳細に解説されています
  - https://nextjs.org/docs/getting-started/react-essentials
