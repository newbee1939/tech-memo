# 定数積公式による AMM(手数料の取り扱い)

- ここまでは簡単のため Swap 手数料を無視した
- Swap 手数料 0.3%が徴収される場合、ユーザーの入金額 Da に対して手数料を引いた後の額に対して定数積公式が適用される
- (Xa + 0.997 × Da) × (Xb - Db) = K
- 取引手数料相当の Da\*0.003 は流動性プールにそのまま残される
- なので積 K の値は、一回の取引でわずかに増加する

# 定数積公式 AMM: 要点

- Swap(トークン A と B の交換)
  - 流動性プール内のトークン A,B の比率を価格と呼ぶ
  - 例えば、A=WBTC,B=USDC だとすると、1WBTC を入金して得られる USDC の量は Xb/Xa にほぼ等しい
  - 入金するトークン A の量が多くなるほど、交換レートが価格から乖離して悪くなる
  - 手数料がゼロならトークン A,B の量の積は定数だが、手数料を考慮するとトークン A,B の量の積は swap によって少しだけ増える
- Pool(流動性の提供)
  - 必ず、流動性プール内のトークン A,B の量と同じ比率で預け入れる必要がある
  - Swap 手数料が流動性プール内に蓄積していくことにより、流動性提供者は報酬を得ることができる
